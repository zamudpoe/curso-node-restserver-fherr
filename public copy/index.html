<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Google Sign-In</title>
  </head>
  <body>
    <h1>Google Sign-In</h1>
    <hr>

    <div 
      id               = "g_id_onload" 
      data-client_id   = "484457677160-m5jmltd3u986gcheo1j7c1k4hvl233i5.apps.googleusercontent.com" 
      data-auto_prompt = "false" 
      data-callback    = "handleCredentialResponse" 
    >
    </div>

    <div 
      class               = "g_id_signin"
      data-type           = "standard"
      data-size           = "large"
      data-theme          = "outline"
      data-text           = "sign_in_with"
      data-shape          = "rectangular"
      data-logo_alignment = "left"
    >
    </div>   

    <hr>

    <button 
      id      = "js_google_signout" 
       
    >
      Sign Out
    </button>


    <!-- --------------------------------[ Script ]-------------------------------- -->    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      // No funciona con una arrow function , solo funcion tradicional!.
      function handleCredentialResponse(response) { 

        // Google Token : ID_TOKEN
        // console.log( `Google ID_TOOKEN: ${ response.credential }`) 

        const body               = { id_token : response.credential }
        const urlGoogleAuthRoute = "http://localhost:4500/api/auth/google"

        fetch( urlGoogleAuthRoute , {
          method: 'POST',
          headers : {
            'content-type': 'application/json'
          },
          body: JSON.stringify( body ) 
        }) 
        .then( res => res.json() ) 
        .then( res => {
          console.log( res )
          localStorage.setItem('googleEmail', res.usuario.correo )
          location.reload() 
        } )
        .catch( err => console.log( err.msg ) ) 
      }

      // Referencias al DOM;
      const jsBtn_SignOut = document.getElementById('js_google_signout')

      // Event Listeners 
      jsBtn_SignOut.addEventListener('click', () => { 
        console.log("\n\t%cConstruyendo Log Out\n","color: teal; font-size: 3em; font-weight: bold") 
        
        // si ya estamos firmados tenemos acceso a 
        console.log( google.accounts.id )        
        google.accounts.id.disableAutoSelect() 
        google.accounts.id.revoke( localStorage.getItem('googleEmail') , done => {
          localStorage.clear() 
          location.reload() 
        } ) 
      }) 
      

    </script>    
  </body>
</html>


